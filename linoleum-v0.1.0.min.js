/*! linoleum.js - 0.1.0 - Bernard McManus - 2014-02-09 */
!function(){function a(a,b,c){function d(a){$(a).hx("transform",g),$(a).find(".inner").hx("transform",h).done(e.bind(this))}function e(){i.push(1),i.length===this.length&&c.call(this)}function f(){this.forEach(d.bind(this))}var g=$.extend({translate:this[a].home,relative:!1},b),h=$.extend({rotate:{x:1,a:80},relative:!1},b),i=[];f.call(this)}function b(a,b,e){function h(a,c,d){var e={x:d*a.dims.width+b.margin*(d+1),y:c*a.dims.height+b.margin*(c+1)};a.setHome(e),$(a).hx("transform",{translate:e,relative:!1}),$(a).find(".inner").hx("transform",{relative:!1}).done(j.bind(this))}function i(c){var e=d.call(this,c,b);$(a).children(".sizer").css("height",e+"px")}function j(){m.push(1),m.length===this.length&&e.call(this)}function k(){var a=c.call(this,b),d=g.call(this,a,l),e=f.call(this,d);i.call(this,e);for(var j=0,k=0;e>k;k++)for(var m=0;d>m;m++)j>=this.length||(h.call(this,this[j],k,m),j++);return d}e=e||function(){};var l=a.getBoundingClientRect(),m=[];return k.call(this)}function c(a){return this[0].dims.width*this.length+a.margin*(this.length+1)}function d(a,b){return this[0].dims.height*a+b.margin*(a+1)}function e(a){return a/this.length}function f(a){return Math.ceil(this.length/a)}function g(a,b){for(var c=e.call(this,a),d=0;d*c<b.width;)d++;return d*c>b.width&&(d-=1),d}var h={margin:20,delay:200,duration:300,easing:"easeOutBack"};window.linoleum=function(a){var b=document.querySelectorAll(a);if(b.length<1)throw"Error: You must pass a valid selector to the linoleum constructor.";var c=[];return Array.prototype.forEach.call(b,function(a){c.push(new linoleum.tile(a))}),$.extend(c,this)},linoleum.prototype={distribute:function(a,c,d){if(this._setView("distribute")&&!(this.length<1)){if(!a||""===a)throw"Error: You must pass a valid selector to linoleum.distribute.";var e=document.querySelector(a);if(!e||e.length<1)throw"Error: You must pass a valid selector to linoleum.distribute.";c=$.extend({margin:h.margin,duration:h.duration,easing:h.easing},c||{}),this.Columns=b.call(this,e,c,d)}},stack:function(b,c,d){this._setView("stack")&&(d=d||function(){},b=(b>=this.length?this.length-1:0>b?0:b)||0,c=c||{},a.call(this,b,c,d))},_setView:function(a){return this.view===a?!1:(this._stopListen(this.view),"distribute"===a?this._activate():this._deactivate(),this._startListen(a),this.view=a,!0)},_startListen:function(a){this.listener||"function"!=typeof i[a]||(this.listener=i[a].bind(this),j[a].call(this,this.listener))},_stopListen:function(a){a&&this.listener&&"function"==typeof i[a]&&(k[a].call(this,this.listener),this.listener=null)},_activate:function(){$(this).css("pointer-events","auto")},_deactivate:function(){$(this).css("pointer-events","none")}};var i={};i.distribute=function(){var a=this[0].parentNode,d=a.getBoundingClientRect(),e=c.call(this,h),f=g.call(this,e,d);if(this.Columns!==f){var i=setTimeout(function(){this.Columns=b.call(this,a,h)}.bind(this),h.delay);$(window).on("resize",function j(){$(window).off("resize",j),clearTimeout(i)})}};var j={};j.distribute=function(a){$(window).on("resize",a)};var k={};k.distribute=function(a){$(window).off("resize",a)}}(),function(a){function b(a){var b=a.getBoundingClientRect(),c={width:parseInt(getComputedStyle(a).width,10),height:parseInt(getComputedStyle(a).height,10),left:b.left,top:b.top};return c.right=c.left+c.width,c.bottom=c.top+c.height,c}function c(a,b){var c={translate:{z:b},duration:0,fallback:!1,relative:!1};$(a).hx("transform",c)}function d(a,b){b=b||{};var c=h[a].call(this);return c.booty=$.extend(c.booty,b),c.inner=$.extend(c.inner,b),c}function e(a){var b={x:0,y:0};return a?(b.x=a.width/2-this.dims.width/2,b.y=window.innerHeight/2-a.top-this.dims.height/2,b):b}function f(a){var b=a.getBoundingClientRect(),c=parseInt(getComputedStyle(a).top,10),d=window.innerWidth-b.width,e=window.innerHeight-2*c;return this.perspective-(d>e?d:e)}var g=function(a,c){if(!a)throw"Error: You must pass an element to the linoleum.tile constructor.";return c=$.extend({dims:b(a),perspective:1e3,thickness:.01,view:"home",home:{}},c||{}),$.extend(this,c),this._init(a)};g.prototype={_init:function(a){a.style.webkitPerspective=this.perspective+"px",a.style.perspective=this.perspective+"px";var b=$(a).find(".face.front").get(0),d=$(a).find(".face.back").get(0),e=this.thickness*this.perspective/2;return c(b,e),c(d,-e),$.extend(a,this)},setView:function(a,b,c){if(this.view!==a){if("function"!=typeof h[a])throw"Error: linoleum.tile has no view '"+a+"'.";c=c||function(){};var e=d.call(this,a,b);$(this).hx("transform",e.booty),$(this).find(".inner").hx("transform",e.inner).done(function(){this.view=a,c.call(this)}.bind(this))}},setHome:function(a){this.home=a},_activate:function(){$(this).siblings(".active").length>0&&$(this).siblings(".active").get(0).setView("home"),$(this).addClass("active")},_deactivate:function(){$(this).removeClass("active")}};var h={};h.home=function(){var a={translate:this.home,relative:!1},b={relative:!1};return this._deactivate(),{booty:a,inner:b}},h.modal=function(){var a=this.parentNode.getBoundingClientRect(),b=e.call(this,a),c=f.call(this,this.parentNode);return booty={translate:b,relative:!1},inner={translate:{z:c},rotate:{y:1,a:180},relative:!1},this._activate(),{booty:booty,inner:inner}},$.extend(a,{tile:g})}(linoleum);