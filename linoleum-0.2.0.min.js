/*! linoleum.js - 0.2.0 - Bernard McManus - 2014-06-04 */
!function(a){function b(c,d){var e=document.querySelectorAll(c);if(e.length<1)throw new TypeError("Invalid selector.");var f=this;f.options=$.extend(!0,h,d||{}),f.cache={},f.enabled=!0,f.container=null,$.extend(f,i),f.handleEvent=f._handleEvent.bind(f),$(a).on("linoleum resize orientationchange",f.handleEvent),Array.prototype.forEach.call(e,function(a,c){f.push(new b.Tile(a,f.options.tile));var d=a.dataset[f.options.indexAttribute];"undefined"==typeof d&&a.setAttribute(f.options.indexAttribute,c)}),Object.defineProperty(f,"sticky",{get:function(){return f.filter(function(a){return a.sticky}).map(function(a){return a.index})}}),Object.defineProperty(f,"included",{get:function(){return f.reduce(function(a,b){return a+=b.included?1:0},0)}}),Object.defineProperty(f,"totalWidth",{get:function(){return f.reduce(function(a,b){return a+=b.included?b.bcr.width:0},0)}}),Object.defineProperty(f,"marginX",{get:function(){return f.options.margin.left+f.options.margin.right}}),Object.defineProperty(f,"totalX",{get:function(){return f.totalWidth+f.marginX*f.included}}),Object.defineProperty(f,"averageX",{get:function(){return f.totalX/f.included}}),Object.defineProperty(f,"totalHeight",{get:function(){return f.getIncluded().reduce(function(a,b,c){return a+=c<f.rows?b.bcr.height:0},0)}}),Object.defineProperty(f,"marginY",{get:function(){return f.options.margin.top+f.options.margin.bottom}}),Object.defineProperty(f,"totalY",{get:function(){return f.totalHeight+f.marginY*f.rows}}),Object.defineProperty(f,"averageY",{get:function(){return f.totalY/f.rows}}),Object.defineProperty(f,"containerBCR",{get:function(){return f.container?f.container.getBoundingClientRect():{}}}),Object.defineProperty(f,"columns",{get:function(){return f.container?Math.floor(f.containerBCR.width/f.averageX)||1:0}}),Object.defineProperty(f,"rows",{get:function(){return f.container?Math.ceil(f.included/f.columns):0}})}function c(a){for(var b=[],c=0,e=0;e<a.rows;e++)for(var f=0;f<a.columns&&!(c>=a.included);f++)b.push(d(a,a[c],e,f)),c++;return b}function d(a,b,c,d){return{x:d*b.bcr.width+a.marginX*(d+1)+g(a,b),y:c*b.bcr.height+a.options.margin.top*(c+1)+a.options.margin.bottom*c}}function e(a,b,c,d){a.getIncluded().forEach(function(d,e){var g=a.grid[e];if(d.defineView("home",f(g)),!d.active){var h={type:"transform",translate:g,easing:b.easing,duration:b.duration},i={type:"transform",rotate:null,duration:b.duration,easing:b.easing};"zero"===c?($(d).hx("zero",h),$(d).find(".inner").hx("zero",i)):($(d).hx(h),$(d).find(".inner").hx(i))}}),"zero"!==c&&$(a).hx("done",d)}function f(a){return{tile:function(b){return b._hx.components.transform=[],b._hx.order.transform=[],{type:"transform",translate:a}},inner:function(a){var b=a.querySelector(".inner");return b._hx.components.transform=[],b._hx.order.transform=[],{type:"transform"}},after:function(a){a.deactivate()}}}function g(a,b){return(a.containerBCR.width-b.bcr.width*a.columns-a.marginX*(a.columns+1))/2}var h={margin:{left:10,right:10,top:10,bottom:10},indexAttribute:"data-index",stickyClass:"sticky",excludeClass:"exclude",disableClass:"disable",activeClass:"active",distroDelay:200,duration:400,easing:"ease"};h.tile={indexAttribute:h.indexAttribute,stickyClass:h.stickyClass,excludeClass:h.excludeClass,disableClass:h.disableClass,activeClass:h.activeClass,perspective:1e4,thickness:1e-4};var i={onTileInclude:function(){},onTileExclude:function(){},beforeFilter:function(){},afterFilter:function(){},beforeSort:function(){},afterSort:function(){}};b.prototype=Object.create(Array.prototype),b.prototype._handleEvent=function(a,b){switch(a.type){case"resize":case"orientationchange":this._onViewportChangeEvent(a,b)}},b.prototype._updateCache=function(){var a=this.cache;a.columns=this.columns,a.rows=this.rows},b.prototype._onViewportChangeEvent=function(){var a=this;if("distribute"===a.view){if(a.columns===a.cache.columns||!a.options.distroDelay)return void a.distribute(null,{},null,"zero");a.rejectViewPromise=a.rejectViewPromise||function(){},a.rejectViewPromise();var b,c;b=new Promise(function(b,d){a.rejectViewPromise=d,c=setTimeout(b,a.options.distroDelay)}),b.then(function(){a.distribute()}),b.catch(function(){clearTimeout(c)})}},b.prototype.distribute=function(a,b,d,f){var g=this;if(b=b||{},d=d||function(){},g.container=a?document.querySelector(a):g.container,g.view="distribute",!g.container)throw new TypeError("linoleum.distribute requires a container.");return b=$.extend({duration:g.options.duration,easing:g.options.easing},b),g.grid=c(g),e(g,b,f,function(){"zero"!==f&&($(document).trigger("linoleum.distribute",{rows:g.rows,columns:g.columns}),g._updateCache()),d()}),g.resize(),g},b.prototype.lSort=function(a){a=a||function(){return 0};var b=this;b.beforeSort();var c=b.getSticky(),d=b.filter(function(a){return!a.sticky}).sort(a);return c.forEach(function(a,c){var e=b.sticky[c];d.splice(e,0,a)}),$.extend(b,d),b.afterSort(),b},b.prototype.lFilter=function(a){a=a||function(){return!0};var b=this;b.beforeFilter();var c=b.getSticky(),d=b.filter(function(b){if(b.sticky)return!1;var c=a(b);return c?b.include():b.exclude(),!0});return c.forEach(function(a,c){var e=b.sticky[c];d.splice(e,0,a)}),$.extend(b,d),b.afterFilter(),b},b.prototype.getSticky=function(){return this.filter(function(a){return a.sticky})},b.prototype.getIncluded=function(){return this.filter(function(a){return a.included})},b.prototype.enable=function(){this.forEach(function(a){a.enable()}),this.enabled=!0},b.prototype.disable=function(a){this.forEach(function(b){(a||!b.active)&&b.disable()}),this.enabled=!1},b.prototype.resize=function(){$(this.container).children(".sizer").height()!==this.totalY&&($(this.container).children(".sizer").css("height",this.totalY+"px"),$(document).trigger("linoleum.resize",{rows:this.rows,columns:this.columns}))},b.prototype.destroy=function(){$(a).off("linoleum resize orientationchange",this.handleEvent)},a.Linoleum=b}(window),function(a){function b(){this.view="home",this.views={}}function c(a,c){$.extend(this,new b,c||{});var e=d(this,a);return Object.defineProperty(e,"index",{get:function(){var a=e.indexAttribute.replace(/data\-/,"");return parseInt(e.dataset[a],10)},configurable:!0}),Object.defineProperty(e,"sticky",{get:function(){return $(e).hasClass(e.stickyClass)},configurable:!0}),Object.defineProperty(e,"active",{get:function(){return $(e).hasClass(e.activeClass)},configurable:!0}),Object.defineProperty(e,"included",{get:function(){return!$(e).hasClass(e.excludeClass)},configurable:!0}),Object.defineProperty(e,"enabled",{get:function(){return!$(e).hasClass(e.disableClass)},configurable:!0}),e}function d(a,b){a.bcr=e(b),$(b).css({"-webkit-perspective":a.perspective+"px",perspective:a.perspective+"px"});var c=$(b).find(".face.front").get(0),d=$(b).find(".face.back").get(0),g=a.thickness*a.perspective;return f(c,g),f(d,-g,180),$.extend(b,a)}function e(a){var b=a.getBoundingClientRect(),c={width:parseInt(getComputedStyle(a).width,10),height:parseInt(getComputedStyle(a).height,10),left:b.left,top:b.top};return c.right=c.left+c.width,c.bottom=c.top+c.height,c}function f(a,b,c){$(a).hx({type:"transform",translate:{z:b},rotateY:c,duration:0,fallback:!1})}function g(a,b,c){var d=a.views[b]||j.views[b];if(!d)return!1;c=c||{};var e=$.extend({},d);return j.hxViewKeys.forEach(function(b){var d=e[b];"function"==typeof d&&(d=d(a)),Array.isArray(d)||(d=[d]),d.forEach(function(a){$.extend(a,c)}),e[b]=d}),e}function h(a,b,c,d){d=d||function(){};var e=a,f=a.querySelector(".inner");c.before(a),$(e).hx(c.tile),$(f).hx(c.inner),$([e,f]).hx("done",function(){a.view=b,c.after(a),d()})}function i(a){this.tile=function(){return{type:"transform"}},this.inner=function(){return{type:"transform"}},this.before=function(){},this.after=function(){},$.extend(this,a)}var j={views:{},hxViewKeys:["tile","inner"]};c.defineView=function(a,b){j.views[a]=new i(b)},c.prototype={defineView:function(a,b){this.views[a]=new i(b)},setView:function(a,b,c){if(this.view!==a&&this.enabled){var d=g(this,a,b);if(!d)throw new TypeError("linoleum.tile has no view '"+a+"'.");h(this,a,d,c)}},stick:function(){$(this).addClass(this.stickyClass)},unstick:function(){$(this).removeClass(this.stickyClass)},enable:function(){$(this).removeClass(this.disableClass)},disable:function(){$(this).addClass(this.disableClass)},include:function(){$(this).removeClass(this.excludeClass)},exclude:function(){$(this).addClass(this.excludeClass)},activate:function(){$(this).addClass(this.activeClass)},deactivate:function(){$(this).removeClass(this.activeClass)}},$.extend(a,{Tile:c})}(Linoleum);