/*! linoleum.js - 0.1.5 - Bernard McManus - 2014-03-28 */
!function(){function a(a,b,c){function d(a){$(a).hx(g),$(a).find(".inner").hx(h).done(e.bind(this))}function e(){i++,i===this.length&&c.call(this)}function f(){this.forEach(d.bind(this))}var g=$.extend({type:"transform",translate:a},b),h=$.extend({type:"transform",rotate:{x:1,a:80}},b),i=0;f.call(this)}function b(a,b,e){function f(a,d,e){var f=c(a,l,b),g={x:e*a.dims.width+b.margin.left*(e+1)+b.margin.right*(e+1)+f,y:d*a.dims.height+b.margin.bottom*d+b.margin.top*(d+1)};a.setHome(g),$(a).hx("clear").hx({type:"transform",translate:g,easing:b.easing,duration:b.duration}),$(a).find(".inner").hx("clear").hx({type:"transform",rotate:null,duration:b.duration,easing:b.easing}).done(i.bind(this))}function i(){n++,n===this.length&&(this.sizeSizer(b),e.call(this))}function j(){var a=d.call(this,b);l=h.call(this,a,k),m=g.call(this,l);for(var c=0,e=0;m>e;e++)for(var i=0;l>i;i++)c>=this.length||(f.call(this,this[c],e,i),c++)}e=e||function(){};var k=a.getBoundingClientRect(),l=0,m=0,n=0;return j.call(this),{Columns:l,Rows:m}}function c(a,b,c){var d=a.parentNode.getBoundingClientRect(),e=c.margin.left+c.margin.right;return(d.width-a.dims.width*b-e*(b+1))/2}function d(a){var b=a.margin.left+a.margin.right;return this[0].dims.width*this.length+b*(this.length+1)}function e(a,b){var c=b.margin.top+b.margin.bottom;return this[0].dims.height*a+c*(a+1)}function f(a){return a/this.length}function g(a){return Math.ceil(this.length/a)}function h(a,b){for(var c=f.call(this,a),d=0;d*c<b.width;)d++;return d*c>b.width&&(d-=1),d}var i={enabled:!0,margin:{left:10,right:10,top:10,bottom:10},stackPosition:{x:0,y:0},distroDelay:200,duration:300,easing:"ease",tile:{perspective:1e4,thickness:.001,modal:{x:null,y:null,z:5e3}}};window.linoleum=function(a,b){var c=document.querySelectorAll(a);if(c.length<1)throw"Error: You must pass a valid selector to the linoleum constructor.";this.options=$.extend(!0,i,b||{}),this.listeners={};var d=[];Array.prototype.forEach.call(c,function(a){d.push(new linoleum.tile(a,this.options.tile))}.bind(this));var e=$.extend(d,this);return e.options.enabled?e.enable():e.disable(),e},linoleum.prototype={distribute:function(a,c,d){if(this._setView("distribute")&&!(this.length<1)){if(!a||""===a)throw"Error: You must pass a valid selector to linoleum.distribute.";var e=document.querySelector(a);if(!e||e.length<1)throw"Error: You must pass a valid selector to linoleum.distribute.";this._startListen("sizer"),c=$.extend({margin:this.options.margin,duration:this.options.duration,easing:this.options.easing},c||{});var f=b.call(this,e,c,function(){this.enable(),d.call(this)});return this.Columns=f.Columns,this.Rows=f.Rows,this}},stack:function(b,c,d){if(this._setView("stack")){this._stopListen("sizer"),b=$.extend(i.stackPosition,b||{}),c=$.extend({duration:this.options.duration,easing:this.options.easing},c||{}),d=d||function(){};for(var e=null,f=0;f<this.length;f++)if("home"!==this[f].view){e=f;break}return null!==e?this[e].setView("home",c,function(){a.call(this,b,c,d)}.bind(this)):a.call(this,b,c,d),this}},_setView:function(a){return this.view===a?!1:(this._stopListen(this.view),"distribute"===a?this._activate():this._deactivate(),this._startListen(a),this.view=a,!0)},_startListen:function(a){this.listeners[a]||"function"!=typeof j[a]||(this.listeners[a]=j[a].bind(this),k[a].call(this,this.listeners[a]))},_stopListen:function(a){a&&this.listeners[a]&&"function"==typeof j[a]&&(l[a].call(this,this.listeners[a]),delete this.listeners[a])},isEnabled:function(){return this.enabled===!0},enable:function(){this.forEach(function(a){a.enable()}),this.enabled=!0},disable:function(a){this.forEach(function(b){(a||!$(b).hasClass("active"))&&b.disable()}),this.enabled=!1},_activate:function(){$(this).css("pointer-events","")},_deactivate:function(){$(this).css("pointer-events","none")},sizeSizer:function(a){if("undefined"!=typeof this.Rows){a=$.extend({margin:this.options.margin},a||{});var b=this[0].parentNode,c=e.call(this,this.Rows,a);$(b).children(".sizer").css("height",c+"px")}}};var j={distribute:function(){var a=this[0].parentNode,c=a.getBoundingClientRect(),e=d.call(this,this.options),f=h.call(this,e,c);if(this.Columns===f){var g=$.extend({},this.options,{duration:0,fallback:!1});return void b.call(this,a,g)}var i=null,j=function(){var c=b.call(this,a,i);this.Columns=c.Columns,this.Rows=c.Rows}.bind(this);if(this.options.distroDelay){i=this.options;var k=setTimeout(j,this.options.distroDelay);$(window).on("resize orientationchange",function l(){$(window).off("resize orientationchange",l),clearTimeout(k)})}else i={duration:0,fallback:!1,margin:this.options.margin},$(window).on("resize orientationchange",j)},sizer:function(){function a(a){a="undefined"!=typeof a&&"object"!=typeof a?a:$(window).height()-c.top-$(window).scrollTop(),$(b).children(".sizer").css("min-height",a+"px")}{var b=this[0].parentNode,c=b.getBoundingClientRect();parseInt(getComputedStyle(b).top,10)}a()}},k={distribute:function(a){$(window).on("resize orientationchange",a)},sizer:function(a){$(window).on("resize orientationchange",a),a()}},l={distribute:function(a){$(window).off("resize orientationchange",a)},sizer:function(a){$(window).off("resize orientationchange",a)}}}(),function(a){function b(a){var b=a.getBoundingClientRect(),c={width:parseInt(getComputedStyle(a).width,10),height:parseInt(getComputedStyle(a).height,10),left:b.left,top:b.top};return c.right=c.left+c.width,c.bottom=c.top+c.height,c}function c(a,b){$(a).hx({type:"transform",translate:{z:b},duration:0,fallback:!1})}function d(a,b){b=b||{};var c=g[a].call(this,b);return delete b.modal,c.xform.tile=$.extend(c.xform.tile,b),c.xform.inner=$.extend(c.xform.inner,b),c}function e(a,b){var c={x:0,y:0};return a?(b=$.extend(this.modal,b||{}),c.x=null!==b.x?b.x:a.width/2-this.dims.width/2,c.y=null!==b.y?b.y:$(window).height()/2-a.top-this.dims.height/2,c):c}var f=function(a,c){if(!a)throw"Error: You must pass an element to the linoleum.tile constructor.";return c=$.extend({enabled:!0,dims:b(a),view:"home",home:{}},c),$.extend(this,c),this._init(a)};f.prototype={_init:function(a){a.style.webkitPerspective=this.perspective+"px",a.style.perspective=this.perspective+"px";var b=$(a).find(".face.front").get(0),d=$(a).find(".face.back").get(0),e=this.thickness*this.perspective/2;return c(b,e),c(d,-e),$.extend(a,this)},setView:function(a,b,c){if(this.view!==a&&this.enabled){if("function"!=typeof g[a])throw"Error: linoleum.tile has no view '"+a+"'.";c=c||function(){};var e=d.call(this,a,b);e.callback=e.callback||function(){},$(this).hx(e.xform.tile),$(this).find(".inner").hx(e.xform.inner).done(function(){this.view=a,e.callback.call(this),c.call(this)}.bind(this))}},setHome:function(a){this.home=a},isEnabled:function(){return this.enabled===!0},enable:function(){this.enabled=!0,$(this).css("pointer-events","")},disable:function(){this.enabled=!1,$(this).css("pointer-events","none")},_activate:function(){$(this).addClass("active")},_deactivate:function(){$(this).removeClass("active")}};var g={home:function(){function a(){this._deactivate()}var b={type:"transform",translate:this.home},c={type:"transform",translate:null,rotate:null};return{callback:a,xform:{tile:b,inner:c}}},modal:function(a){a=a||{};var b=this.parentNode.getBoundingClientRect(),c=e.call(this,b,a.modal),d={type:"transform",translate:c},f=this.modal.z;"undefined"!=typeof a.modal&&"undefined"!=typeof a.modal.z&&(f=a.modal.z);var g={type:"transform",translate:{z:f},rotate:{y:1,a:180}};return this._activate(),{xform:{tile:d,inner:g}}}};$.extend(a,{tile:f})}(linoleum);