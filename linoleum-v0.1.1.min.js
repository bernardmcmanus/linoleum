/*! linoleum.js - 0.1.1 - Bernard McManus - 2014-03-01 */
!function(){function a(a,b,c){function d(a){$(a).hx("transform",g),$(a).find(".inner").hx("transform",h).done(e.bind(this))}function e(){i++,i===this.length&&c.call(this)}function f(){this.forEach(d.bind(this))}var g=$.extend({translate:a,relative:!1},b),h=$.extend({rotate:{x:1,a:80},relative:!1},b),i=0;f.call(this)}function b(a,b,f){function i(a,d,e){var f=c(a,n,b),g={x:e*a.dims.width+b.margin.left*(e+1)+b.margin.right*(e+1)+f,y:d*a.dims.height+b.margin.bottom*d+b.margin.top*(d+1)};a.setHome(g),$(a).hx("transform",{translate:g,easing:b.easing,duration:b.duration,relative:!1}),$(a).find(".inner").hx("transform",{duration:b.duration,easing:b.easing,relative:!1}).done(k.bind(this))}function j(c){var d=e.call(this,c,b);$(a).children(".sizer").css("height",d+"px")}function k(){p++,p===this.length&&f.call(this)}function l(){var a=d.call(this,b);n=h.call(this,a,m),o=g.call(this,n),j.call(this,o);for(var c=0,e=0;o>e;e++)for(var f=0;n>f;f++)c>=this.length||(i.call(this,this[c],e,f),c++)}f=f||function(){};var m=a.getBoundingClientRect(),n=0,o=0,p=0;return l.call(this),n}function c(a,b,c){var d=a.parentNode.getBoundingClientRect(),e=c.margin.left+c.margin.right;return(d.width-a.dims.width*b-e*(b+1))/2}function d(a){var b=a.margin.left+a.margin.right;return this[0].dims.width*this.length+b*(this.length+1)}function e(a,b){var c=b.margin.top+b.margin.bottom;return this[0].dims.height*a+c*(a+1)}function f(a){return a/this.length}function g(a){return Math.ceil(this.length/a)}function h(a,b){for(var c=f.call(this,a),d=0;d*c<b.width;)d++;return d*c>b.width&&(d-=1),d}var i={margin:{left:10,right:10,top:10,bottom:10},stackPosition:{x:0,y:0},distroDelay:200,duration:300,easing:"ease",tile:{perspective:1e4,thickness:.001,modalZ:.5}};window.linoleum=function(a,b){var c=document.querySelectorAll(a);if(c.length<1)throw"Error: You must pass a valid selector to the linoleum constructor.";this.options=$.extend(!0,i,b||{});var d=[];return Array.prototype.forEach.call(c,function(a){d.push(new linoleum.tile(a,this.options.tile))}.bind(this)),$.extend(d,this)},linoleum.prototype={distribute:function(a,c,d){if(this._setView("distribute")&&!(this.length<1)){if(!a||""===a)throw"Error: You must pass a valid selector to linoleum.distribute.";var e=document.querySelector(a);if(!e||e.length<1)throw"Error: You must pass a valid selector to linoleum.distribute.";c=$.extend({margin:this.options.margin,duration:this.options.duration,easing:this.options.easing},c||{}),this.Columns=b.call(this,e,c,d)}},stack:function(b,c,d){if(this._setView("stack")){b=$.extend(i.stackPosition,b||{}),c=$.extend({duration:this.options.duration,easing:this.options.easing},c||{}),d=d||function(){};for(var e=null,f=0;f<this.length;f++)if("home"!==this[f].view){e=f;break}null!==e?this[e].setView("home",c,function(){a.call(this,b,c,d)}.bind(this)):a.call(this,b,c,d)}},_setView:function(a){return this.view===a?!1:(this._stopListen(this.view),"distribute"===a?this._activate():this._deactivate(),this._startListen(a),this.view=a,!0)},_startListen:function(a){this.listener||"function"!=typeof j[a]||(this.listener=j[a].bind(this),k[a].call(this,this.listener))},_stopListen:function(a){a&&this.listener&&"function"==typeof j[a]&&(l[a].call(this,this.listener),this.listener=null)},_activate:function(){$(this).css("pointer-events","auto")},_deactivate:function(){$(this).css("pointer-events","none")}};var j={};j.distribute=function(){var a=this[0].parentNode,c=a.getBoundingClientRect(),e=d.call(this,this.options),f=h.call(this,e,c);if(this.Columns===f){var g=$.extend({},this.options,{duration:0,fallback:!1});return void b.call(this,a,g)}var i=setTimeout(function(){this.Columns=b.call(this,a,this.options)}.bind(this),this.options.distroDelay);$(window).on("resize orientationchange",function j(){$(window).off("resize orientationchange",j),clearTimeout(i)})};var k={};k.distribute=function(a){$(window).on("resize orientationchange",a)};var l={};l.distribute=function(a){$(window).off("resize orientationchange",a)}}(),function(a){function b(a){var b=a.getBoundingClientRect(),c={width:parseInt(getComputedStyle(a).width,10),height:parseInt(getComputedStyle(a).height,10),left:b.left,top:b.top};return c.right=c.left+c.width,c.bottom=c.top+c.height,c}function c(a,b){var c={translate:{z:b},duration:0,fallback:!1,relative:!1};$(a).hx("transform",c)}function d(a,b){b=b||{};var c=h[a].call(this,b);return delete b.modalZ,c.xform.tile=$.extend(c.xform.tile,b),c.xform.inner=$.extend(c.xform.inner,b),c}function e(a){var b={x:0,y:0};return a?(b.x=a.width/2-this.dims.width/2,b.y=window.innerHeight/2-a.top-this.dims.height/2,$(window).scrollTop()<a.top&&(b.y+=a.top-$(window).scrollTop()),b):b}function f(a){return this.perspective*(a||this.modalZ)}var g=function(a,c){if(!a)throw"Error: You must pass an element to the linoleum.tile constructor.";return c=$.extend({dims:b(a),view:"home",home:{}},c),$.extend(this,c),this._init(a)};g.prototype={_init:function(a){a.style.webkitPerspective=this.perspective+"px",a.style.perspective=this.perspective+"px";var b=$(a).find(".face.front").get(0),d=$(a).find(".face.back").get(0),e=this.thickness*this.perspective/2;return c(b,e),c(d,-e),$.extend(a,this)},setView:function(a,b,c){if(this.view!==a){if("function"!=typeof h[a])throw"Error: linoleum.tile has no view '"+a+"'.";c=c||function(){};var e=d.call(this,a,b);e.callback=e.callback||function(){},$(this).hx("transform",e.xform.tile),$(this).find(".inner").hx("transform",e.xform.inner).done(function(){this.view=a,e.callback.call(this),c.call(this)}.bind(this))}},setHome:function(a){this.home=a},_activate:function(){$(this).siblings(".active").length>0&&$(this).siblings(".active").get(0).setView("home"),$(this).addClass("active")},_deactivate:function(){$(this).removeClass("active")}};var h={};h.home=function(){function a(){this._deactivate()}var b={translate:this.home,relative:!1},c={relative:!1};return{callback:a,xform:{tile:b,inner:c}}},h.modal=function(a){var b=this.parentNode.getBoundingClientRect(),c=e.call(this,b),d=f.call(this,a.modalZ),g={translate:c,relative:!1},h={translate:{z:d},rotate:{y:1,a:180},relative:!1};return this._activate(),{xform:{tile:g,inner:h}}},$.extend(a,{tile:g})}(linoleum);