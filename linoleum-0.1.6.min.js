/*! linoleum.js - 0.1.6 - Bernard McManus - 2014-04-08 */
!function(){function a(a,b,c,d){function e(a,b){b=b||function(){},$(a).hx(g),$(a).find(".inner").hx(h).done(b)}function f(){var b=a.getIncluded(),c=[];b.forEach(function(a){c.push(new Promise(function(b){e(a,b)}))}),Promise.all(c).then(d.bind(a))}var g=$.extend({type:"transform",translate:b},c),h=$.extend({type:"transform",rotate:{x:1,a:80}},c);f()}function b(a,b,e){function f(d,e,f,g){g=g||function(){};var h=c(a,d,l,b),i={x:f*d.dims.width+b.margin.left*(f+1)+b.margin.right*(f+1)+h,y:e*d.dims.height+b.margin.bottom*e+b.margin.top*(e+1)};d.setHome(i),$(d).hx({type:"transform",translate:i,easing:b.easing,duration:b.duration}),$(d).find(".inner").hx({type:"transform",rotate:null,duration:b.duration,easing:b.easing}).done(g)}function i(){var c=d(a,b);l=h(a,c,k),m=g(a,l);for(var i=0,j=a.getIncluded(),n=[],o=0;m>o;o++)for(var p=0;l>p;p++)i>=a.count()||(n.push(new Promise(function(a){f(j[i],o,p,a)})),i++);Promise.all(n).then(e.bind(a))}e=e||function(){};var j=document.querySelector(a.distroSelector),k=j.getBoundingClientRect(),l=0,m=0;return i(),{Columns:l,Rows:m}}function c(a,b,c,d){var e=document.querySelector(a.distroSelector),f=e.getBoundingClientRect(),g=d.margin.left+d.margin.right;return(f.width-b.dims.width*c-g*(c+1))/2}function d(a,b){var c=b.margin.left+b.margin.right;return a[0].dims.width*a.count()+c*(a.count()+1)}function e(a,b,c){var d=c.margin.top+c.margin.bottom;return a[0].dims.height*b+d*(b+1)}function f(a,b){return b/a.count()}function g(a,b){return Math.ceil(a.count()/b)}function h(a,b,c){for(var d=f(a,b),e=0;e*d<c.width;)e++;return e*d>c.width&&(e-=1),e}var i={enabled:!0,margin:{left:10,right:10,top:10,bottom:10},stackPosition:{x:0,y:0},distroDelay:200,distroSelector:null,duration:300,easing:"ease",tile:{perspective:1e4,thickness:1e-4,modal:{x:null,y:null,z:5e3}}},j={onTileInclude:function(){},onTileExclude:function(){},beforeFilter:function(){},afterFilter:function(){},beforeSort:function(){},afterSort:function(){}};window.linoleum=function(a,b){var c=document.querySelectorAll(a);if(c.length<1)throw"Error: You must pass a valid selector to the linoleum constructor.";$.extend(this,j),this.options=$.extend(!0,i,b||{}),this.listeners={};var d=[];Array.prototype.forEach.call(c,function(a){d.push(new linoleum.tile(a,this.options.tile))}.bind(this));var e=$.extend(d,this);return e.options.enabled?e.enable():e.disable(),e},linoleum.prototype={distribute:function(a,c,d){if(a=a||this.distroSelector,this._setView("distribute")&&!(this.count(!0)<1)){if(!a||""===a)throw"Error: You must pass a valid selector to linoleum.distribute.";this.distroSelector=a;{document.querySelector(a)}if(!document.querySelector(a))throw"Error: You must pass a valid selector to linoleum.distribute.";this._startListen("sizer"),c=$.extend({margin:this.options.margin,duration:this.options.duration,easing:this.options.easing},c||{});var e=b(this,c,function(){this.enable(),this.sizeSizer(),d.call(this)});return this.Columns=e.Columns,this.Rows=e.Rows,this}},stack:function(b,c,d){if(this._setView("stack")){this._stopListen("sizer"),b=$.extend(i.stackPosition,b||{}),c=$.extend({duration:this.options.duration,easing:this.options.easing},c||{}),d=d||function(){};for(var e=null,f=0;f<this.count(!0);f++)if("home"!==this[f].view){e=f;break}return null!==e?this[e].setView("home",c,function(){a(this,b,c,d)}.bind(this)):a(this,b,c,d),this}},sort:function(a){console.log(a)},filter:function(a){a=a||[],this.beforeFilter(),this.forEach(function(b,c){a.indexOf(c)>=0?(b.exclude(),this.onTileExclude(b)):b.isIncluded()||(b.include(),this.onTileInclude(b))}.bind(this)),this.afterFilter()},count:function(a){a="undefined"!=typeof a?a:!1;var b=0;return this.forEach(function(c){(c.isIncluded()||a)&&b++}),b},getIncluded:function(){var a=[];return this.forEach(function(b){b.isIncluded()&&a.push(b)}),a},getExcluded:function(){var a=[];return this.forEach(function(b){b.isIncluded()||a.push(b)}),a},_setView:function(a){return this.view===a?!0:(this._stopListen(this.view),"distribute"===a?this._activate():this._deactivate(),this._startListen(a),this.view=a,!0)},_startListen:function(a){this.listeners[a]||"function"!=typeof k[a]||(this.listeners[a]=k[a].bind(this),l[a].call(this,this.listeners[a]))},_stopListen:function(a){a&&this.listeners[a]&&"function"==typeof k[a]&&(m[a].call(this,this.listeners[a]),delete this.listeners[a])},isEnabled:function(){return this.enabled===!0},enable:function(){this.forEach(function(a){a.enable()}),this.enabled=!0},disable:function(a){this.forEach(function(b){(a||!$(b).hasClass("active"))&&b.disable()}),this.enabled=!1},_activate:function(){$(this).css("pointer-events","")},_deactivate:function(){$(this).css("pointer-events","none")},sizeSizer:function(a){if("undefined"!=typeof this.Rows){a=$.extend({margin:this.options.margin},a||{});var b=document.querySelector(this.distroSelector),c=e(this,this.Rows,a);$(b).children(".sizer").css("height",c+"px")}}};var k={distribute:function(){var a=document.querySelector(this.distroSelector),c=a.getBoundingClientRect(),e=d(this,this.options),f=h(this,e,c);if(this.Columns===f){var g=$.extend({},this.options,{duration:0,fallback:!1});return void b(this,g)}var i=null,j=function(){var a=b(this,i);this.Columns=a.Columns,this.Rows=a.Rows}.bind(this);if(this.options.distroDelay){i=this.options;var k=setTimeout(j,this.options.distroDelay);$(window).on("resize orientationchange",function l(){$(window).off("resize orientationchange",l),clearTimeout(k)})}else i={duration:0,fallback:!1,margin:this.options.margin},$(window).on("resize orientationchange",j)},sizer:function(){function a(a){a="undefined"!=typeof a&&"object"!=typeof a?a:$(window).height()-c.top-$(window).scrollTop(),$(b).children(".sizer").css("min-height",a+"px")}{var b=document.querySelector(this.distroSelector),c=b.getBoundingClientRect();parseInt(getComputedStyle(b).top,10)}a()}},l={distribute:function(a){$(window).on("resize orientationchange",a)},sizer:function(a){$(window).on("resize orientationchange",a),a()}},m={distribute:function(a){$(window).off("resize orientationchange",a)},sizer:function(a){$(window).off("resize orientationchange",a)}}}(),function(a){function b(a){var b=a.getBoundingClientRect(),c={width:parseInt(getComputedStyle(a).width,10),height:parseInt(getComputedStyle(a).height,10),left:b.left,top:b.top};return c.right=c.left+c.width,c.bottom=c.top+c.height,c}function c(a,b,c){$(a).hx({type:"transform",translate:{z:b},rotateY:c||null,duration:0,fallback:!1})}function d(a,b){b=b||{};var c=h[a].call(this,b);return delete b.modal,c.xform.tile=$.extend(c.xform.tile,b),c.xform.inner=$.extend(c.xform.inner,b),c}function e(a,b){var c={x:0,y:0};return a?(b=$.extend(this.modal,b||{}),c.x=null!==b.x?b.x:a.width/2-this.dims.width/2,c.y=null!==b.y?b.y:$(window).height()/2-a.top-this.dims.height/2,c):c}var f={enabled:!0,view:"home",home:{},Include:!0},g=function(a,b){if(!a)throw"Error: You must pass an element to the linoleum.tile constructor.";return $.extend(this,f,b),this._init(a)};g.prototype={_init:function(a){this.dims=b(a),a.style.webkitPerspective=this.perspective+"px",a.style.perspective=this.perspective+"px";var d=$(a).find(".face.front").get(0),e=$(a).find(".face.back").get(0),f=this.thickness*this.perspective/1;return c(d,f),c(e,-f,180),$.extend(a,this)},setView:function(a,b,c){if(this.view!==a&&this.enabled){if("function"!=typeof h[a])throw"Error: linoleum.tile has no view '"+a+"'.";c=c||function(){};var e=d.call(this,a,b);e.callback=e.callback||function(){},$(this).hx(e.xform.tile),$(this).find(".inner").hx(e.xform.inner).done(function(){this.view=a,e.callback.call(this),c.call(this)}.bind(this))}},setHome:function(a){this.home=a},isEnabled:function(){return this.enabled===!0},isIncluded:function(){return this.Include===!0},exclude:function(){this.Include=!1,this.disable()},include:function(){this.Include=!0,this.enable()},enable:function(){this.isIncluded()&&(this.enabled=!0,$(this).css("pointer-events",""))},disable:function(){this.enabled=!1,$(this).css("pointer-events","none")},_activate:function(){$(this).addClass("active")},_deactivate:function(){$(this).removeClass("active")}};var h={home:function(){function a(){this._deactivate()}var b={type:"transform",translate:this.home},c={type:"transform",translate:null,rotate:null};return{callback:a,xform:{tile:b,inner:c}}},modal:function(a){a=a||{};var b=this.parentNode.getBoundingClientRect(),c=e.call(this,b,a.modal),d={type:"transform",translate:c},f=this.modal.z;"undefined"!=typeof a.modal&&"undefined"!=typeof a.modal.z&&(f=a.modal.z);var g={type:"transform",translate:{z:f},rotate:{y:1,a:180}};return this._activate(),{xform:{tile:d,inner:g}}}};$.extend(a,{tile:g})}(linoleum);