/*! linoleum.js - 0.1.8 - Bernard McManus - 2014-05-04 */
!function(){function a(a){var b=[];return a.forEach(function(a){a.isSticky()&&b.push(a.getIndex())}),b}function b(a,b,c,d){function e(a,b){b=b||function(){},$(a).hx(g),$(a).find(".inner").hx(h).done(b)}function f(){var b=a.getIncluded(),c=[];b.forEach(function(a){c.push(new Promise(function(b){e(a,b)}))}),Promise.all(c).then(d.bind(a))}var g=$.extend({type:"transform",translate:b},c),h=$.extend({type:"transform",rotate:{x:1,a:80}},c);f()}function c(a,b,c){function f(c,e,f,g){g=g||function(){};var h=d(a,c,l,b),i={x:f*c.dims.width+b.margin.left*(f+1)+b.margin.right*(f+1)+h,y:e*c.dims.height+b.margin.bottom*e+b.margin.top*(e+1)};c.setHome(i),$(c).hx({type:"transform",translate:i,easing:b.easing,duration:b.duration}),$(c).find(".inner").hx({type:"transform",rotate:null,duration:b.duration,easing:b.easing}).done(g)}function g(){var d=e(a,b);l=i(a,d,k),m=h(a,l);for(var g=0,j=a.getIncluded(),n=[],o=0;m>o;o++)for(var p=0;l>p;p++)g>=a.count()||(n.push(new Promise(function(a){f(j[g],o,p,a)})),g++);Promise.all(n).then(c.bind(a))}c=c||function(){};var j=document.querySelector(a.distroSelector),k=j.getBoundingClientRect(),l=0,m=0;return g(),{Columns:l,Rows:m}}function d(a,b,c,d){var e=document.querySelector(a.distroSelector),f=e.getBoundingClientRect(),g=d.margin.left+d.margin.right;return(f.width-b.dims.width*c-g*(c+1))/2}function e(a,b){var c=b.margin.left+b.margin.right;return a[0].dims.width*a.count()+c*(a.count()+1)}function f(a,b,c){var d=c.margin.top+c.margin.bottom;return a[0].dims.height*b+d*(b+1)}function g(a,b){return b/a.count()}function h(a,b){return Math.ceil(a.count()/b)}function i(a,b,c){for(var d=g(a,b),e=0;e*d<c.width;)e++;return e*d>c.width&&(e-=1),e}var j={enabled:!0,margin:{left:10,right:10,top:10,bottom:10},stackPosition:{x:0,y:0},indexAttribute:"data-index",stickyClass:"sticky",distroDelay:200,distroSelector:null,duration:300,easing:"ease"};j.tile={indexAttribute:j.indexAttribute,stickyClass:j.stickyClass,perspective:1e4,thickness:1e-4,modal:{x:null,y:null,z:5e3}};var k={onTileInclude:function(){},onTileExclude:function(){},beforeFilter:function(){},afterFilter:function(){},beforeSort:function(){},afterSort:function(){}};window.linoleum=function(b,c){var d=document.querySelectorAll(b);if(d.length<1)throw"Error: You must pass a valid selector to the linoleum constructor.";$.extend(this,k),this.options=$.extend(!0,j,c||{}),this.listeners={};var e=[];Array.prototype.forEach.call(d,function(a,b){e.push(new linoleum.tile(a,this.options.tile));var c=a.dataset[this.options.indexAttribute];"undefined"==typeof c&&a.setAttribute(this.options.indexAttribute,b)}.bind(this));var f=$.extend(e,this);return f.options.enabled?f.enable():f.disable(),f.stickyIndexes=a(f),f},linoleum.prototype={distribute:function(a,b,d){if(a=a||this.distroSelector,this._setView("distribute")&&!(this.count(!0)<1)){if(!a||""===a)throw"Error: You must pass a valid selector to linoleum.distribute.";if(this.distroSelector=a,!document.querySelector(a))throw"Error: You must pass a valid selector to linoleum.distribute.";this._startListen("sizer"),b=$.extend({margin:this.options.margin,duration:this.options.duration,easing:this.options.easing},b||{});var e=c(this,b,function(){this.enable(),d.call(this)});return this.Columns=e.Columns,this.Rows=e.Rows,this.sizeSizer(),this}},stack:function(a,c,d){if(this._setView("stack")){this._stopListen("sizer"),a=$.extend(j.stackPosition,a||{}),c=$.extend({duration:this.options.duration,easing:this.options.easing},c||{}),d=d||function(){};for(var e=null,f=0;f<this.count(!0);f++)if("home"!==this[f].view){e=f;break}return null!==e?this[e].setView("home",c,function(){b(this,a,c,function(){d.apply(this,arguments)})}.bind(this)):b(this,a,c,function(){d.apply(this,arguments)}),this}},sort:function(a){a=a||function(){return 0};var b=this;b.beforeSort();var c=b.getSticky(),d=b.getTiles().sort(a);c.forEach(function(a,c){var e=b.stickyIndexes[c];d.splice(e,0,a)}),$.extend(b,d),b.afterSort()},filter:function(a){a=a||[];var b=this;b.beforeFilter(),b.forEach(function(c){if(!c.isSticky()){var d=c.getIndex();a.indexOf(d)>=0?(c.exclude(),b.onTileExclude(c)):c.isIncluded()||(c.include(),b.onTileInclude(c))}}),b.afterFilter()},count:function(a){a="undefined"!=typeof a?a:!1;var b=0;return this.forEach(function(c){(c.isIncluded()||a)&&b++}),b},getTiles:function(a){a="undefined"!=typeof a?a:!1;var b=[];return this.forEach(function(c){(!c.isSticky()||a)&&b.push(c)}),b},getSticky:function(){var a=[];return this.forEach(function(b){b.isSticky()&&a.push(b)}),a},getIncluded:function(){var a=[];return this.forEach(function(b){b.isIncluded()&&a.push(b)}),a},getExcluded:function(){var a=[];return this.forEach(function(b){b.isIncluded()||a.push(b)}),a},_setView:function(a){return this.view===a?!0:(this._stopListen(this.view),"distribute"===a?this._activate():this._deactivate(),this._startListen(a),this.view=a,!0)},_startListen:function(a){this.listeners[a]||"function"!=typeof l[a]||(this.listeners[a]=l[a].bind(this),m[a].call(this,this.listeners[a]))},_stopListen:function(a){a&&this.listeners[a]&&"function"==typeof l[a]&&(n[a].call(this,this.listeners[a]),delete this.listeners[a])},isEnabled:function(){return this.enabled===!0},enable:function(){this.forEach(function(a){a.enable()}),this.enabled=!0},disable:function(a){this.forEach(function(b){(a||!$(b).hasClass("active"))&&b.disable()}),this.enabled=!1},_activate:function(){$(this).css("pointer-events","")},_deactivate:function(){$(this).css("pointer-events","none")},sizeSizer:function(a){if("undefined"!=typeof this.Rows){a=$.extend({margin:this.options.margin},a||{});var b=document.querySelector(this.distroSelector),c=f(this,this.Rows,a);$(b).children(".sizer").css("height",c+"px")}}};var l={distribute:function(){var a=document.querySelector(this.distroSelector),b=a.getBoundingClientRect(),d=e(this,this.options),f=i(this,d,b);if(this.Columns===f){var g=$.extend({},this.options,{duration:0,fallback:!1});return void c(this,g)}var h=null,j=function(){var a=c(this,h);this.Columns=a.Columns,this.Rows=a.Rows,this.sizeSizer()}.bind(this);if(this.options.distroDelay){h=this.options;var k=setTimeout(j,this.options.distroDelay);$(window).on("resize orientationchange",function l(){$(window).off("resize orientationchange",l),clearTimeout(k)})}else h={duration:0,fallback:!1,margin:this.options.margin},$(window).on("resize orientationchange",j)},sizer:function(){function a(a){a="undefined"!=typeof a&&"object"!=typeof a?a:$(window).height()-c.top-$(window).scrollTop(),$(b).children(".sizer").css("min-height",a+"px")}{var b=document.querySelector(this.distroSelector),c=b.getBoundingClientRect();parseInt(getComputedStyle(b).top,10)}a()}},m={distribute:function(a){$(window).on("resize orientationchange",a)},sizer:function(a){$(window).on("resize orientationchange",a),a()}},n={distribute:function(a){$(window).off("resize orientationchange",a)},sizer:function(a){$(window).off("resize orientationchange",a)}}}(),function(a){function b(a){var b=a.getBoundingClientRect(),c={width:parseInt(getComputedStyle(a).width,10),height:parseInt(getComputedStyle(a).height,10),left:b.left,top:b.top};return c.right=c.left+c.width,c.bottom=c.top+c.height,c}function c(a,b,c){$(a).hx({type:"transform",translate:{z:b},rotateY:c||null,duration:0,fallback:!1})}function d(a,b){b=b||{};var c=h[a].call(this,b);return delete b.modal,c.xform.tile=$.extend(c.xform.tile,b),c.xform.inner=$.extend(c.xform.inner,b),c}function e(a,b){var c={x:0,y:0};return a?(b=$.extend(this.modal,b||{}),c.x=null!==b.x?b.x:a.width/2-this.dims.width/2,c.y=null!==b.y?b.y:$(window).height()/2-a.top-this.dims.height/2,c):c}var f={enabled:!0,view:"home",home:{},Include:!0},g=function(a,b){if(!a)throw"Error: You must pass an element to the linoleum.tile constructor.";return $.extend(this,f,b),this._init(a)};g.prototype={_init:function(a){this.dims=b(a),$(a).css({"-webkit-perspective":this.perspective+"px",perspective:this.perspective+"px"});var d=$(a).find(".face.front").get(0),e=$(a).find(".face.back").get(0),f=this.thickness*this.perspective/1;return c(d,f),c(e,-f,180),$.extend(a,this)},setView:function(a,b,c){if(this.view!==a&&this.enabled){if("function"!=typeof h[a])throw"Error: linoleum.tile has no view '"+a+"'.";c=c||function(){};var e=d.call(this,a,b);e.callback=e.callback||function(){},$(this).hx(e.xform.tile),$(this).find(".inner").hx(e.xform.inner).done(function(){this.view=a,e.callback.call(this),c.call(this)}.bind(this))}},setHome:function(a){this.home=a},isEnabled:function(){return this.enabled===!0},isIncluded:function(){return this.Include===!0},isSticky:function(){return $(this).hasClass(this.stickyClass)},exclude:function(){this.Include=!1,this.disable()},include:function(){this.Include=!0,this.enable()},getIndex:function(){var a=this.indexAttribute.replace(/data\-/,"");return parseInt(this.dataset[a],10)},enable:function(){this.isIncluded()&&(this.enabled=!0,$(this).css("pointer-events",""))},disable:function(){this.enabled=!1,$(this).css("pointer-events","none")},_activate:function(){$(this).addClass("active")},_deactivate:function(){$(this).removeClass("active")}};var h={home:function(){function a(){this._deactivate()}var b={type:"transform",translate:this.home},c={type:"transform",translate:null,rotate:null};return{callback:a,xform:{tile:b,inner:c}}},modal:function(a){a=a||{};var b=this.parentNode.getBoundingClientRect(),c=e.call(this,b,a.modal),d={type:"transform",translate:c},f=this.modal.z;"undefined"!=typeof a.modal&&"undefined"!=typeof a.modal.z&&(f=a.modal.z);var g={type:"transform",translate:{z:f},rotate:{y:1,a:180}};return this._activate(),{xform:{tile:d,inner:g}}}};$.extend(a,{tile:g})}(linoleum);